--[[


                        Roblox UI Library
                        Based on Ui test React design
                        Converted to Roblox Lua


]]



local inputservice =	game:GetService("InsertService")
local tweenservice = 	game:GetService("TweenService")
local https = 			game:GetService("HttpService")
local runservice =		game:GetService("RunService")
local userinput =		game:GetService("UserInputService")
local players =         game:GetService("Players"):GetPlayers()
local textservice =     game:GetService('TextService')
local player =          game:GetService('Players')
local coregui =         game:GetService("CoreGui")
local textservice =     game:GetService('TextService')

local screenSize =      workspace.CurrentCamera.ViewportSize
local isMobile =        userinput.TouchEnabled or (screenSize.X < 1024 and screenSize.Y < 768)
local dragOffset =        255
local dragOffsetMobile =  150
local camera =          workspace.CurrentCamera

local sharedModule = {}
local resizing = false

-- Load the UI assets (placeholder - will need actual Roblox assets)
local Loader =          game:GetObjects("rbxassetid://110221114597158")[1]  -- Placeholder
local Library =         game:GetObjects("rbxassetid://123800669522471")[1]  -- Placeholder

Library.Enabled = false
local loaded = false

local RobloxUI = {

	theme = {
		-- Dark theme matching the React UI
		background = Color3.fromRGB(9, 9, 9),
		foreground = Color3.fromRGB(245, 245, 245),
		panel = Color3.fromRGB(19, 19, 19),
		accentPanel = Color3.fromRGB(24, 24, 24),
		hover = Color3.fromRGB(32, 32, 32),
		active = Color3.fromRGB(36, 36, 36),
		accentBright = Color3.fromRGB(70, 70, 70),
		muted = Color3.fromRGB(85, 85, 85),
		border = Color3.fromRGB(32, 32, 32),
	},
	Connections = {},
	Comms = Instance.new('BindableEvent'),
	ParentOverride = nil;
	Build = 'RUI1';
	ConfigEnabled = false;
	ConfigFolder = 'RobloxUI';
	ConfigFile = 'Config';
	Flags = {};
	SettingsFlags = {};
}


-- [ THEME MANAGEMENT ]
function RobloxUI:UpdateTheme(Config)
	if type(Config) ~= "table" then
		warn("[UpdateTheme] Invalid configuration table")
		return
	end

	local updatedKeys = {}

	for key, value in pairs(Config) do
		if self.theme[key] ~= nil then
			if typeof(self.theme[key]) == typeof(value) then
				if type(value) == "table" then
					self:DeepMerge(self.theme[key], value)
				else
					self.theme[key] = value
				end
				table.insert(updatedKeys, key)
			else
				warn(("[UpdateTheme] Type mismatch for key '%s' (expected %s, got %s)"):format(
					key, typeof(self.theme[key]), typeof(value)
					))
			end
		else
			warn("[UpdateTheme] Key '" .. key .. "' does not exist in theme")
		end
	end

	if #updatedKeys > 0 then
		for _, key in ipairs(updatedKeys) do
			self.Comms:Fire(key, self.theme[key])
		end
	end
end

function RobloxUI:DeepMerge(target, source)
	for k, v in pairs(source) do
		if type(v) == "table" and type(target[k]) == "table" then
			self:DeepMerge(target[k], v) 
		else
			target[k] = v
		end
	end
end

-- [UTILITIES]

function RobloxUI:getdark(Color, val, mode)
	if typeof(Color) ~= "Color3" or type(val) ~= "number" then
		warn("[getdark] Invalid input: Expected (Color3, number)")
		return Color
	end

	local H, S, V = Color:ToHSV()

	val = math.clamp(val, 0.1, 10) 

	if mode == "subtract" then
		V = math.clamp(V - (val / 10), 0, 1)  
	else
		V = math.clamp(V / val, 0, 1)  
	end

	return Color3.fromHSV(H, S, V)
end

function RobloxUI:HidePlaceHolder(instance, placeholder, recursive)
	if typeof(instance) ~= "Instance" or type(placeholder) ~= "string" then
		warn("[removeplaceholder] Invalid input: Expected (Instance, string)")
		return
	end

	local target = instance:FindFirstChild(placeholder)

	if not target then
		warn(("[removeplaceholder] Placeholder '%s' not found in instance '%s'"):format(placeholder, instance.Name))
		return
	end

	if target:IsA("GuiObject") then
		target.Visible = false
	else
		warn(("[removeplaceholder] '%s' is not a GuiObject and cannot be hidden"):format(placeholder))
		return
	end

	if recursive then
		for _, child in ipairs(target:GetDescendants()) do
			if child:IsA("GuiObject") then
				child.Visible = false
			end
		end
	end
end

function RobloxUI:AddConnection(Type, Callback)
	if typeof(Type) ~= "RBXScriptSignal" then
		error("[AddConnection] Invalid Type: Expected RBXScriptSignal, got " .. typeof(Type))
	end
	if typeof(Callback) ~= "function" then
		error("[AddConnection] Invalid Callback: Expected function, got " .. typeof(Callback))
	end

	local Connection = Type:Connect(Callback)
	local ConnectionData = { Connection = Connection }

	RobloxUI.Connections = RobloxUI.Connections or {}
	table.insert(RobloxUI.Connections, ConnectionData)

	local function Disconnect()
		if Connection.Connected then
			Connection:Disconnect()
		end

		for i = #RobloxUI.Connections, 1, -1 do
			if RobloxUI.Connections[i] == ConnectionData then
				table.remove(RobloxUI.Connections, i)
				break
			end
		end
	end

	task.spawn(function()
		task.wait(10)
		for i = #RobloxUI.Connections, 1, -1 do
			if not RobloxUI.Connections[i].Connection.Connected then
				table.remove(RobloxUI.Connections, i)
			end
		end
	end)

	return Connection, Disconnect
end

function RobloxUI:MakeResizable(Dragger, Object, MinSize, Callback, LockAspectRatio)
	assert(typeof(Dragger) == "Instance" and Dragger:IsA("GuiObject"), "[MakeResizable] Dragger must be a GuiObject")
	assert(typeof(Object) == "Instance" and Object:IsA("GuiObject"), "[MakeResizable] Object must be a GuiObject")
	assert(typeof(MinSize) == "Vector2", "[MakeResizable] MinSize must be a Vector2")
	assert(Callback == nil or typeof(Callback) == "function", "[MakeResizable] Callback must be a function or nil")

	local userInput = game:GetService("UserInputService")

	local startPosition, startSize = nil, nil
	local isResizing = false

	-- helper for both mouse and touch
	local function getInputPos(input)
		if input.UserInputType == Enum.UserInputType.Touch then
			return Vector2.new(input.Position.X, input.Position.Y)
		else
			return userInput:GetMouseLocation()
		end
	end

	local function onInputBegan(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			isResizing = true
			resizing = true
			startPosition = getInputPos(input)
			startSize = Object.AbsoluteSize
			tweenservice:Create(Library.lib.resize, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {Size = UDim2.new(0, 15,0, 15)}):Play()
		end
	end

	local function onInputChanged(input)
		if isResizing and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local mouse = getInputPos(input)
			if startPosition and mouse then
				local delta = mouse - startPosition

				local newWidth = math.max(MinSize.X, startSize.X + delta.X)
				local newHeight = math.max(MinSize.Y, startSize.Y + delta.Y)

				if LockAspectRatio then
					local aspectRatio = startSize.X / startSize.Y
					newHeight = newWidth / aspectRatio
				end

				Object:TweenSize(
					UDim2.fromOffset(newWidth, newHeight),
					Enum.EasingDirection.Out,
					Enum.EasingStyle.Quint,
					0.7,
					true
				)

				if Callback then
					Callback(Vector2.new(newWidth, newHeight))
				end
			end
		end
	end

	local function onInputEnded(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			isResizing = false
			resizing = false
			startPosition, startSize = nil, nil
			tweenservice:Create(Library.lib.resize, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {Size = UDim2.new(0, 20,0, 20)}):Play()
		end
	end

	RobloxUI:AddConnection(Dragger.InputBegan, onInputBegan)
	RobloxUI:AddConnection(userInput.InputChanged, onInputChanged)
	RobloxUI:AddConnection(Dragger.InputEnded, onInputEnded)
end

local dragSpeed = 0.5
local LockToScreen = false

function RobloxUI:AddDrag(Object, Main, ConstrainToParent)
	assert(typeof(Object) == "Instance" and Object:IsA("GuiObject"), "[AddDrag] Object must be a GuiObject")
	assert(typeof(Main) == "Instance" and Main:IsA("GuiObject"), "[AddDrag] Main must be a GuiObject")

	local userInput = game:GetService("UserInputService")
	local tweenService = game:GetService("TweenService")

	local dragging, dragInput, startMousePos, startFramePos = false, nil, nil, nil

	local function getConstrainedPosition(newPos)
		if not LockToScreen then
			return newPos
		end

		local screenSize = workspace.CurrentCamera.ViewportSize
		local frameSize = Main.AbsoluteSize
		local anchorPoint = Main.AnchorPoint

		-- Calculate the absolute position based on newPos
		local absX = newPos.X.Offset
		local absY = newPos.Y.Offset

		local minX = 0 + (frameSize.X * anchorPoint.X)
		local maxX = screenSize.X - (frameSize.X * (1 - anchorPoint.X))

		local minY = 0 + (frameSize.Y * anchorPoint.Y)
		local maxY = screenSize.Y - (frameSize.Y * (1 - anchorPoint.Y))

		local clampedX = math.clamp(absX, minX, maxX)
		local clampedY = math.clamp(absY, minY, maxY)

		return UDim2.new(0, clampedX, 0, clampedY)
	end

	local function getInputPos(input)
		if input.UserInputType == Enum.UserInputType.Touch then
			return Vector2.new(input.Position.X, input.Position.Y)
		else
			return userInput:GetMouseLocation()
		end
	end




	RobloxUI:AddConnection(Object.InputBegan, function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			startMousePos = getInputPos(input)

			local screenSize = workspace.CurrentCamera.ViewportSize
			local absX = screenSize.X * Main.Position.X.Scale + Main.Position.X.Offset
			local absY = screenSize.Y * Main.Position.Y.Scale + Main.Position.Y.Offset

			Main.Position = UDim2.new(0, absX, 0, absY)
			startFramePos = Main.Position
		end
	end)


	RobloxUI:AddConnection(userInput.InputChanged, function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local currentMousePos = getInputPos(input)
			if currentMousePos and startMousePos then
				local delta = currentMousePos - startMousePos

				local newPos = UDim2.new(
					startFramePos.X.Scale, startFramePos.X.Offset + delta.X,
					startFramePos.Y.Scale, startFramePos.Y.Offset + delta.Y
				)

				Main:TweenPosition(getConstrainedPosition(newPos), Enum.EasingDirection.Out, Enum.EasingStyle.Quint, dragSpeed, true)
			end
		end
	end)

	RobloxUI:AddConnection(Object.InputEnded, function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = false
		end
	end)
end

function RobloxUI:updateLayout(container, spacing)
	spacing = spacing or 5
	local yOffset = 0
	local containerWidth = container.AbsoluteSize.X 

	for _, v in ipairs(container:GetChildren()) do
		if v:IsA('UIListLayout') then
			v:Destroy()
		end
	end

	if resizing == false then
		for _, child in ipairs(container:GetChildren()) do
			if (child:IsA("Frame") or child:IsA("ImageLabel") or child:IsA("TextLabel") or child:IsA("TextButton")) and child.Visible then
				--child.Size = UDim2.new(1, -10, 0, child.Size.Y.Offset) -- Full width, fixed height
				-- child.Position = UDim2.new(0, 0, 0, yOffset)
				tweenservice:Create(child, TweenInfo.new(0.45, Enum.EasingStyle.Exponential), {Position = UDim2.new(0, 0, 0, yOffset)}):Play()
				yOffset = yOffset + child.AbsoluteSize.Y + spacing
			end
		end
	end


	container.CanvasSize = UDim2.new(0, 0, 0, yOffset)
end

-- [ UI INITIALIZATION ]
function RobloxUI:Init(config)
	print('RobloxUI Library Loaded')
	
	config = config or {}
	config.Title = config.Title or 'Roblox UI'
	config.SubText = config.SubText or 'Modern Dark UI'
	
	-- Create main UI structure
	local UI = Library
	local WINDOW = UI.lib
	local TOPBAR = WINDOW.Top
	local SIDEBAR = WINDOW.Sidebar  -- New: Sidebar for navigation
	local CONTENT = WINDOW.Content  -- New: Content panel
	local TABS = CONTENT.Tabs       -- New: Tabs within content
	
	-- Setup theme
	UI.Enabled = true
	
	-- Configure window
	TOPBAR.Title.Text = config.Title
	TOPBAR.Title.Sub.Text = config.SubText
	TOPBAR.Title.Sub.TextColor3 = Color3.new(1,1,1)
	
	-- Setup drag and resize
	RobloxUI:AddDrag(TOPBAR, WINDOW, true)
	RobloxUI:MakeResizable(WINDOW.resize, WINDOW, Vector2.new(654, 428))
	
	-- Initialize sidebar navigation
	local sections = {
		{
			title = "Aimbot",
			items = {
				{ id = "aimbot-main", label = "Main Settings", icon = "Crosshair" },
				{ id = "aimbot-target", label = "Target Priority", icon = "Target" },
				{ id = "aimbot-prediction", label = "Prediction", icon = "Zap" },
			},
		},
		{
			title = "Visual",
			items = {
				{ id = "visual-esp", label = "ESP", icon = "Eye" },
				{ id = "visual-chams", label = "Chams", icon = "Sparkles" },
				{ id = "visual-players", label = "Players", icon = "Users" },
			},
		},
		{
			title = "Modifications",
			items = {
				{ id = "mod-character", label = "Character", icon = "Shield" },
				{ id = "mod-movement", label = "Movement", icon = "Zap" },
			},
		},
		{
			title = "Miscellaneous",
			items = {
				{ id = "misc-settings", label = "Settings", icon = "Settings2" },
				{ id = "misc-config", label = "Configuration", icon = "Wrench" },
			},
		},
	}
	
	-- Build sidebar
	RobloxUI:BuildSidebar(SIDEBAR, sections)
	
	-- Setup content area
	CONTENT.Visible = true
	TABS.Visible = true
	
	return {
		Window = WINDOW,
		Sidebar = SIDEBAR,
		Content = CONTENT,
		Tabs = TABS,
		InitTab = function(tabConfig) return RobloxUI:InitTab(tabConfig, CONTENT) end,
		InitSection = function(sectionConfig) return RobloxUI:InitSection(sectionConfig) end,
	}
end

function RobloxUI:BuildSidebar(sidebar, sections)
	-- Clear existing
	for _, child in ipairs(sidebar:GetChildren()) do
		if child:IsA("Frame") then
			child:Destroy()
		end
	end
	
	local yOffset = 0
	for _, section in ipairs(sections) do
		-- Section header
		local header = Instance.new("TextLabel")
		header.Size = UDim2.new(1, -20, 0, 20)
		header.Position = UDim2.new(0, 10, 0, yOffset)
		header.BackgroundTransparency = 1
		header.Text = section.title
		header.TextColor3 = self.theme.muted
		header.TextSize = 12
		header.Font = Enum.Font.GothamBold
		header.TextXAlignment = Enum.TextXAlignment.Left
		header.Parent = sidebar
		yOffset = yOffset + 25
		
		-- Section items
		for _, item in ipairs(section.items) do
			local itemFrame = Instance.new("Frame")
			itemFrame.Size = UDim2.new(1, -20, 0, 35)
			itemFrame.Position = UDim2.new(0, 10, 0, yOffset)
			itemFrame.BackgroundColor3 = self.theme.accentPanel
			itemFrame.BackgroundTransparency = 0.8
			
			local corner = Instance.new("UICorner")
			corner.CornerRadius = UDim.new(0, 8)
			corner.Parent = itemFrame
			
			local icon = Instance.new("ImageLabel")
			icon.Size = UDim2.new(0, 16, 0, 16)
			icon.Position = UDim2.new(0, 12, 0.5, -8)
			icon.BackgroundTransparency = 1
			icon.Image = "rbxassetid://1234567890" -- Placeholder icon
			icon.Parent = itemFrame
			
			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(1, -40, 1, 0)
			label.Position = UDim2.new(0, 35, 0, 0)
			label.BackgroundTransparency = 1
			label.Text = item.label
			label.TextColor3 = self.theme.foreground
			label.TextSize = 14
			label.Font = Enum.Font.Gotham
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = itemFrame
			
			-- Click handler
			local button = Instance.new("TextButton")
			button.Size = UDim2.new(1, 0, 1, 0)
			button.BackgroundTransparency = 1
			button.Text = ""
			button.Parent = itemFrame
			
			button.MouseButton1Click:Connect(function()
				RobloxUI:SwitchToSection(item.id)
			end)
			
			itemFrame.Parent = sidebar
			yOffset = yOffset + 40
		end
		
		yOffset = yOffset + 10 -- Spacing between sections
	end
	
	sidebar.CanvasSize = UDim2.new(0, 0, 0, yOffset)
end

function RobloxUI:SwitchToSection(sectionId)
	-- Handle section switching logic
	print("Switched to section:", sectionId)
	-- This will be expanded later
end

function RobloxUI:InitTab(tabConfig, parent)
	local tab = {
		Title = tabConfig.Title,
		Section = tabConfig.Section,
		Content = Instance.new("Frame"),
		IsActive = false,
	}
	
	-- Setup tab content frame
	tab.Content.Size = UDim2.new(1, 0, 1, 0)
	tab.Content.BackgroundTransparency = 1
	tab.Content.Visible = false
	tab.Content.Parent = parent
	
	-- Add tab methods
	function tab:Show()
		if self.IsActive then return end
		self.IsActive = true
		self.Content.Visible = true
		
		-- Hide other tabs in same section
		for _, child in ipairs(parent:GetChildren()) do
			if child:IsA("Frame") and child ~= self.Content and child.Name ~= "TabBar" then
				child.Visible = false
				-- Mark other tabs as inactive
				if child._tab then
					child._tab.IsActive = false
				end
			end
		end
	end
	
	function tab:Hide()
		self.IsActive = false
		self.Content.Visible = false
	end
	
	function tab:AddElement(element)
		element.Parent = self.Content
		return element
	end
	
	-- Store reference
	tab.Content._tab = tab
	
	return tab
end

function RobloxUI:InitSection(sectionConfig)
	-- Section initialization logic (placeholder)
	local section = {
		Title = sectionConfig.Title,
		-- Add section methods here
	}
	return section
end

-- [ CONTENT PANEL SYSTEM ]
function RobloxUI:CreateContentPanel(config)
	local panel = Instance.new("Frame")
	panel.Size = UDim2.new(1, -250, 1, -60)  -- Leave space for sidebar and topbar
	panel.Position = UDim2.new(0, 220, 0, 50)
	panel.BackgroundTransparency = 1
	panel.Name = "ContentPanel"
	
	-- Header
	local header = Instance.new("Frame")
	header.Size = UDim2.new(1, 0, 0, 80)
	header.BackgroundTransparency = 1
	header.Parent = panel
	
	-- Icon
	if config.icon then
		local iconFrame = Instance.new("Frame")
		iconFrame.Size = UDim2.new(0, 40, 0, 40)
		iconFrame.Position = UDim2.new(0, 0, 0, 0)
		iconFrame.BackgroundColor3 = self.theme.panel
		iconFrame.BackgroundTransparency = 0.7
		
		local corner = Instance.new("UICorner")
		corner.CornerRadius = UDim.new(0, 12)
		corner.Parent = iconFrame
		
		local icon = Instance.new("ImageLabel")
		icon.Size = UDim2.new(0, 20, 0, 20)
		icon.Position = UDim2.new(0.5, -10, 0.5, -10)
		icon.BackgroundTransparency = 1
		icon.Image = config.icon or "rbxassetid://1234567890"  -- Placeholder
		icon.ImageColor3 = self.theme.foreground
		icon.Parent = iconFrame
		
		iconFrame.Parent = header
	end
	
	-- Title and Description
	local textFrame = Instance.new("Frame")
	textFrame.Size = UDim2.new(1, config.icon and -50 or 0, 1, 0)
	textFrame.Position = UDim2.new(0, config.icon and 50 or 0, 0, 0)
	textFrame.BackgroundTransparency = 1
	textFrame.Parent = header
	
	local title = Instance.new("TextLabel")
	title.Size = UDim2.new(1, 0, 0, 24)
	title.Position = UDim2.new(0, 0, 0, 0)
	title.BackgroundTransparency = 1
	title.Text = config.title or "Settings"
	title.TextColor3 = self.theme.foreground
	title.TextSize = 18
	title.Font = Enum.Font.GothamBold
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.Parent = textFrame
	
	if config.description then
		local desc = Instance.new("TextLabel")
		desc.Size = UDim2.new(1, 0, 0, 16)
		desc.Position = UDim2.new(0, 0, 0, 28)
		desc.BackgroundTransparency = 1
		desc.Text = config.description
		desc.TextColor3 = self.theme.muted
		desc.TextSize = 14
		desc.Font = Enum.Font.Gotham
		desc.TextXAlignment = Enum.TextXAlignment.Left
		desc.Parent = textFrame
	end
	
	-- Tabs
	local tabsFrame = nil
	local activeTabId = config.tabs and config.tabs[1] and config.tabs[1].id or nil
	local tabButtons = {}
	
	if config.tabs and #config.tabs > 0 then
		tabsFrame = Instance.new("Frame")
		tabsFrame.Size = UDim2.new(1, 0, 0, 40)
		tabsFrame.Position = UDim2.new(0, 0, 0, 40)
		tabsFrame.BackgroundColor3 = self.theme.panel
		tabsFrame.BackgroundTransparency = 0.8
		
		local corner = Instance.new("UICorner")
		corner.CornerRadius = UDim.new(0, 12)
		corner.Parent = tabsFrame
		
		local tabContainer = Instance.new("Frame")
		tabContainer.Size = UDim2.new(1, -16, 1, 0)
		tabContainer.Position = UDim2.new(0, 8, 0, 0)
		tabContainer.BackgroundTransparency = 1
		tabContainer.Parent = tabsFrame
		
		local xOffset = 0
		for i, tab in ipairs(config.tabs) do
			local tabButton = Instance.new("TextButton")
			tabButton.Size = UDim2.new(0, 80, 1, -8)
			tabButton.Position = UDim2.new(0, xOffset, 0, 4)
			tabButton.BackgroundTransparency = 1
			tabButton.Text = tab.label
			tabButton.TextColor3 = (tab.id == activeTabId) and self.theme.foreground or self.theme.muted
			tabButton.TextSize = 13
			tabButton.Font = Enum.Font.GothamMedium
			
			local tabCorner = Instance.new("UICorner")
			tabCorner.CornerRadius = UDim.new(0, 8)
			tabCorner.Parent = tabButton
			
			if tab.id == activeTabId then
				tabButton.BackgroundColor3 = self.theme.active
				tabButton.BackgroundTransparency = 0.8
			end
			
			-- Tab click handler
			tabButton.MouseButton1Click:Connect(function()
				-- Update active tab
				activeTabId = tab.id
				
				-- Update button appearances
				for _, btn in ipairs(tabButtons) do
					if btn._tabId == tab.id then
						btn.BackgroundColor3 = self.theme.active
						btn.BackgroundTransparency = 0.8
						btn.TextColor3 = self.theme.foreground
					else
						btn.BackgroundTransparency = 1
						btn.TextColor3 = self.theme.muted
					end
				end
				
				-- Call tab change callback
				if config.onTabChange then
					config.onTabChange(tab.id)
				end
			end)
			
			tabButton._tabId = tab.id
			table.insert(tabButtons, tabButton)
			tabButton.Parent = tabContainer
			xOffset = xOffset + 85
		end
		
		tabsFrame.Parent = header
	end
	
	-- Content area
	local contentArea = Instance.new("ScrollingFrame")
	contentArea.Size = UDim2.new(1, 0, 1, tabsFrame and -120 or -80)
	contentArea.Position = UDim2.new(0, 0, 0, tabsFrame and 120 or 80)
	contentArea.BackgroundTransparency = 1
	contentArea.ScrollBarThickness = 4
	contentArea.ScrollBarImageColor3 = self.theme.accentBright
	contentArea.Parent = panel
	
	local contentContainer = Instance.new("Frame")
	contentContainer.Size = UDim2.new(1, -20, 0, 0)
	contentContainer.Position = UDim2.new(0, 10, 0, 0)
	contentContainer.BackgroundTransparency = 1
	contentContainer.Parent = contentArea
	
	-- Auto-resize content area
	local function updateContentSize()
		local totalHeight = 0
		for _, child in ipairs(contentContainer:GetChildren()) do
			if child:IsA("Frame") and child.Visible then
				totalHeight = totalHeight + child.AbsoluteSize.Y + 16
			end
		end
		contentContainer.Size = UDim2.new(1, -20, 0, totalHeight)
		contentArea.CanvasSize = UDim2.new(0, 0, 0, totalHeight)
	end
	
	contentContainer.ChildAdded:Connect(updateContentSize)
	contentContainer.ChildRemoved:Connect(updateContentSize)
	
	return {
		Frame = panel,
		Content = contentContainer,
		UpdateSize = updateContentSize,
		AddChild = function(child) 
			child.Parent = contentContainer
			updateContentSize()
		end
	}
end

-- [ SETTING CARD COMPONENT ]
function RobloxUI:CreateSettingCard(title)
	local card = Instance.new("Frame")
	card.Size = UDim2.new(1, 0, 0, 60)  -- Will be resized based on content
	card.BackgroundColor3 = self.theme.panel
	card.BackgroundTransparency = 0.8
	
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 16)
	corner.Parent = card
	
	local content = Instance.new("Frame")
	content.Size = UDim2.new(1, -32, 1, -16)
	content.Position = UDim2.new(0, 16, 0, 8)
	content.BackgroundTransparency = 1
	content.Parent = card
	
	-- Title divider (optional)
	if title then
		local divider = Instance.new("Frame")
		divider.Size = UDim2.new(1, 0, 0, 1)
		divider.Position = UDim2.new(0, 0, 0, 0)
		divider.BackgroundColor3 = self.theme.border
		divider.BackgroundTransparency = 0.5
		divider.Parent = content
		
		local titleLabel = Instance.new("TextLabel")
		titleLabel.Size = UDim2.new(0, 100, 0, 20)
		titleLabel.Position = UDim2.new(0.5, -50, 0, -10)
		titleLabel.BackgroundColor3 = self.theme.panel
		titleLabel.BackgroundTransparency = 0.8
		titleLabel.Text = title
		titleLabel.TextColor3 = self.theme.muted
		titleLabel.TextSize = 12
		titleLabel.Font = Enum.Font.GothamBold
		titleLabel.TextXAlignment = Enum.TextXAlignment.Center
		titleLabel.Parent = content
		
		local titleCorner = Instance.new("UICorner")
		titleCorner.CornerRadius = UDim.new(0, 8)
		titleCorner.Parent = titleLabel
	end
	
	local controlsContainer = Instance.new("Frame")
	controlsContainer.Size = UDim2.new(1, 0, 1, title and -20 or 0)
	controlsContainer.Position = UDim2.new(0, 0, 0, title and 20 or 0)
	controlsContainer.BackgroundTransparency = 1
	controlsContainer.Parent = content
	
	return {
		Frame = card,
		Container = controlsContainer,
		AddControl = function(control)
			control.Parent = controlsContainer
			-- Update card height based on controls
			local height = 16
			for _, child in ipairs(controlsContainer:GetChildren()) do
				if child:IsA("Frame") then
					height = height + child.AbsoluteSize.Y + 12
				end
			end
			card.Size = UDim2.new(1, 0, 0, math.max(60, height + 24))
		end
	}
end

-- [ UI CONTROLS ]

-- Toggle Control
function RobloxUI:CreateToggle(config)
	local toggleFrame = Instance.new("Frame")
	toggleFrame.Size = UDim2.new(1, 0, 0, 40)
	toggleFrame.BackgroundTransparency = 1
	
	-- Label and description
	local textFrame = Instance.new("Frame")
	textFrame.Size = UDim2.new(1, -60, 1, 0)
	textFrame.BackgroundTransparency = 1
	textFrame.Parent = toggleFrame
	
	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 0, 20)
	label.Position = UDim2.new(0, 0, 0, 0)
	label.BackgroundTransparency = 1
	label.Text = config.label or "Toggle"
	label.TextColor3 = self.theme.foreground
	label.TextSize = 14
	label.Font = Enum.Font.GothamMedium
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Parent = textFrame
	
	if config.description then
		local desc = Instance.new("TextLabel")
		desc.Size = UDim2.new(1, 0, 0, 16)
		desc.Position = UDim2.new(0, 0, 0, 20)
		desc.BackgroundTransparency = 1
		desc.Text = config.description
		desc.TextColor3 = self.theme.muted
		desc.TextSize = 12
		desc.Font = Enum.Font.Gotham
		desc.TextXAlignment = Enum.TextXAlignment.Left
		desc.Parent = textFrame
	end
	
	-- Toggle switch
	local toggleSwitch = Instance.new("Frame")
	toggleSwitch.Size = UDim2.new(0, 44, 0, 24)
	toggleSwitch.Position = UDim2.new(1, -44, 0, 8)
	toggleSwitch.BackgroundColor3 = config.checked and self.theme.accentBright or self.theme.accentPanel
	toggleSwitch.BackgroundTransparency = 0.8
	
	local switchCorner = Instance.new("UICorner")
	switchCorner.CornerRadius = UDim.new(0, 12)
	switchCorner.Parent = toggleSwitch
	
	local toggleKnob = Instance.new("Frame")
	toggleKnob.Size = UDim2.new(0, 16, 0, 16)
	toggleKnob.Position = config.checked and UDim2.new(1, -20, 0.5, -8) or UDim2.new(0, 4, 0.5, -8)
	toggleKnob.BackgroundColor3 = self.theme.foreground
	toggleKnob.BackgroundTransparency = 0.9
	
	local knobCorner = Instance.new("UICorner")
	knobCorner.CornerRadius = UDim.new(1, 0)
	knobCorner.Parent = toggleKnob
	
	toggleKnob.Parent = toggleSwitch
	toggleSwitch.Parent = toggleFrame
	
	-- Click handler
	local button = Instance.new("TextButton")
	button.Size = UDim2.new(1, 0, 1, 0)
	button.BackgroundTransparency = 1
	button.Text = ""
	button.Parent = toggleFrame
	
	local isChecked = config.checked or false
	
	local function updateToggle()
		local targetColor = isChecked and self.theme.accentBright or self.theme.accentPanel
		local knobPos = isChecked and UDim2.new(1, -20, 0.5, -8) or UDim2.new(0, 4, 0.5, -8)
		
		tweenservice:Create(toggleSwitch, TweenInfo.new(0.2, Enum.EasingStyle.Quart), {
			BackgroundColor3 = targetColor
		}):Play()
		
		tweenservice:Create(toggleKnob, TweenInfo.new(0.2, Enum.EasingStyle.Quart), {
			Position = knobPos
		}):Play()
		
		if config.onChange then
			config.onChange(isChecked)
		end
	end
	
	button.MouseButton1Click:Connect(function()
		isChecked = not isChecked
		updateToggle()
	end)
	
	updateToggle()
	
	return toggleFrame
end

-- Slider Control
function RobloxUI:CreateSlider(config)
	local sliderFrame = Instance.new("Frame")
	sliderFrame.Size = UDim2.new(1, 0, 0, 60)
	sliderFrame.BackgroundTransparency = 1
	
	-- Label and value
	local header = Instance.new("Frame")
	header.Size = UDim2.new(1, 0, 0, 30)
	header.BackgroundTransparency = 1
	header.Parent = sliderFrame
	
	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, -60, 0, 20)
	label.Position = UDim2.new(0, 0, 0, 0)
	label.BackgroundTransparency = 1
	label.Text = config.label or "Slider"
	label.TextColor3 = self.theme.foreground
	label.TextSize = 14
	label.Font = Enum.Font.GothamMedium
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Parent = header
	
	if config.description then
		local desc = Instance.new("TextLabel")
		desc.Size = UDim2.new(1, -60, 0, 16)
		desc.Position = UDim2.new(0, 0, 0, 20)
		desc.BackgroundTransparency = 1
		desc.Text = config.description
		desc.TextColor3 = self.theme.muted
		desc.TextSize = 12
		desc.Font = Enum.Font.Gotham
		desc.TextXAlignment = Enum.TextXAlignment.Left
		desc.Parent = header
	end
	
	local valueLabel = Instance.new("TextLabel")
	valueLabel.Size = UDim2.new(0, 50, 0, 20)
	valueLabel.Position = UDim2.new(1, -50, 0, 0)
	valueLabel.BackgroundTransparency = 1
	valueLabel.Text = tostring(config.value or 0) .. (config.unit or "")
	valueLabel.TextColor3 = self.theme.muted
	valueLabel.TextSize = 14
	valueLabel.Font = Enum.Font.GothamMedium
	valueLabel.TextXAlignment = Enum.TextXAlignment.Right
	valueLabel.Parent = header
	
	-- Slider track
	local track = Instance.new("Frame")
	track.Size = UDim2.new(1, 0, 0, 4)
	track.Position = UDim2.new(0, 0, 0, 35)
	track.BackgroundColor3 = self.theme.accentPanel
	track.BackgroundTransparency = 0.8
	
	local trackCorner = Instance.new("UICorner")
	trackCorner.CornerRadius = UDim.new(1, 0)
	trackCorner.Parent = track
	
	local fill = Instance.new("Frame")
	fill.Size = UDim2.new(0, 0, 1, 0)  -- Will be updated
	fill.BackgroundColor3 = self.theme.accentBright
	fill.BackgroundTransparency = 0.8
	
	local fillCorner = Instance.new("UICorner")
	fillCorner.CornerRadius = UDim.new(1, 0)
	fillCorner.Parent = fill
	
	fill.Parent = track
	track.Parent = sliderFrame
	
	-- Slider input
	local sliderButton = Instance.new("TextButton")
	sliderButton.Size = UDim2.new(1, 0, 0, 20)
	sliderButton.Position = UDim2.new(0, 0, 0, 30)
	sliderButton.BackgroundTransparency = 1
	sliderButton.Text = ""
	sliderButton.Parent = sliderFrame
	
	local min = config.min or 0
	local max = config.max or 100
	local currentValue = config.value or min
	local step = config.step or 1
	
	local function updateSlider()
		local percentage = ((currentValue - min) / (max - min))
		fill.Size = UDim2.new(percentage, 0, 1, 0)
		valueLabel.Text = string.format("%.1f", currentValue) .. (config.unit or "")
		
		if config.onChange then
			config.onChange(currentValue)
		end
	end
	
	local dragging = false
	
	sliderButton.MouseButton1Down:Connect(function()
		dragging = true
	end)
	
	userinput.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)
	
	userinput.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local mousePos = userinput:GetMouseLocation()
			local relativeX = mousePos.X - track.AbsolutePosition.X
			local percentage = math.clamp(relativeX / track.AbsoluteSize.X, 0, 1)
			
			currentValue = min + (max - min) * percentage
			currentValue = math.floor((currentValue - min) / step + 0.5) * step + min
			currentValue = math.clamp(currentValue, min, max)
			
			updateSlider()
		end
	end)
	
	updateSlider()
	
	return sliderFrame
end

-- Dropdown Control
function RobloxUI:CreateDropdown(config)
	local dropdownFrame = Instance.new("Frame")
	dropdownFrame.Size = UDim2.new(1, 0, 0, 40)
	dropdownFrame.BackgroundTransparency = 1
	
	-- Label and description
	local textFrame = Instance.new("Frame")
	textFrame.Size = UDim2.new(1, -140, 1, 0)
	textFrame.BackgroundTransparency = 1
	textFrame.Parent = dropdownFrame
	
	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 0, 20)
	label.Position = UDim2.new(0, 0, 0, 0)
	label.BackgroundTransparency = 1
	label.Text = config.label or "Dropdown"
	label.TextColor3 = self.theme.foreground
	label.TextSize = 14
	label.Font = Enum.Font.GothamMedium
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Parent = textFrame
	
	if config.description then
		local desc = Instance.new("TextLabel")
		desc.Size = UDim2.new(1, 0, 0, 16)
		desc.Position = UDim2.new(0, 0, 0, 20)
		desc.BackgroundTransparency = 1
		desc.Text = config.description
		desc.TextColor3 = self.theme.muted
		desc.TextSize = 12
		desc.Font = Enum.Font.Gotham
		desc.TextXAlignment = Enum.TextXAlignment.Left
		desc.Parent = textFrame
	end
	
	-- Dropdown button
	local dropdownButton = Instance.new("Frame")
	dropdownButton.Size = UDim2.new(0, 120, 0, 32)
	dropdownButton.Position = UDim2.new(1, -120, 0, 4)
	dropdownButton.BackgroundColor3 = self.theme.accentPanel
	dropdownButton.BackgroundTransparency = 0.8
	
	local buttonCorner = Instance.new("UICorner")
	buttonCorner.CornerRadius = UDim.new(0, 8)
	buttonCorner.Parent = dropdownButton
	
	local selectedLabel = Instance.new("TextLabel")
	selectedLabel.Size = UDim2.new(1, -30, 1, 0)
	selectedLabel.Position = UDim2.new(0, 12, 0, 0)
	selectedLabel.BackgroundTransparency = 1
	selectedLabel.Text = config.value or "Select..."
	selectedLabel.TextColor3 = self.theme.foreground
	selectedLabel.TextSize = 14
	selectedLabel.Font = Enum.Font.Gotham
	selectedLabel.TextXAlignment = Enum.TextXAlignment.Left
	selectedLabel.Parent = dropdownButton
	
	local arrow = Instance.new("ImageLabel")
	arrow.Size = UDim2.new(0, 16, 0, 16)
	arrow.Position = UDim2.new(1, -20, 0.5, -8)
	arrow.BackgroundTransparency = 1
	arrow.Image = "rbxassetid://1234567890"  -- Placeholder arrow
	arrow.ImageColor3 = self.theme.muted
	arrow.Parent = dropdownButton
	
	local button = Instance.new("TextButton")
	button.Size = UDim2.new(1, 0, 1, 0)
	button.BackgroundTransparency = 1
	button.Text = ""
	button.Parent = dropdownButton
	
	dropdownButton.Parent = dropdownFrame
	
	-- Dropdown options (placeholder for now)
	local isOpen = false
	
	button.MouseButton1Click:Connect(function()
		isOpen = not isOpen
		-- TODO: Show/hide dropdown options
		print("Dropdown clicked:", config.label, "Open:", isOpen)
	end)
	
	return dropdownFrame
end

-- Section Divider
function RobloxUI:CreateSectionDivider(label)
	local divider = Instance.new("Frame")
	divider.Size = UDim2.new(1, 0, 0, 20)
	divider.BackgroundTransparency = 1
	
	local line1 = Instance.new("Frame")
	line1.Size = UDim2.new(0.4, -40, 0, 1)
	line1.Position = UDim2.new(0, 0, 0.5, 0)
	line1.BackgroundColor3 = self.theme.border
	line1.BackgroundTransparency = 0.5
	line1.Parent = divider
	
	local labelText = Instance.new("TextLabel")
	labelText.Size = UDim2.new(0, 80, 0, 16)
	labelText.Position = UDim2.new(0.5, -40, 0.5, -8)
	labelText.BackgroundColor3 = self.theme.panel
	labelText.BackgroundTransparency = 0.8
	labelText.Text = label or "SECTION"
	labelText.TextColor3 = self.theme.muted
	labelText.TextSize = 12
	labelText.Font = Enum.Font.GothamBold
	labelText.TextXAlignment = Enum.TextXAlignment.Center
	labelText.Parent = divider
	
	local labelCorner = Instance.new("UICorner")
	labelCorner.CornerRadius = UDim.new(0, 6)
	labelCorner.Parent = labelText
	
	local line2 = Instance.new("Frame")
	line2.Size = UDim2.new(0.4, -40, 0, 1)
	line2.Position = UDim2.new(0.6, 40, 0.5, 0)
	line2.BackgroundColor3 = self.theme.border
	line2.BackgroundTransparency = 0.5
	line2.Parent = divider
	
	return divider
end

-- Keybind Control
function RobloxUI:CreateKeybind(config)
	local keybindFrame = Instance.new("Frame")
	keybindFrame.Size = UDim2.new(1, 0, 0, 40)
	keybindFrame.BackgroundTransparency = 1
	
	-- Label and description
	local textFrame = Instance.new("Frame")
	textFrame.Size = UDim2.new(1, -100, 1, 0)
	textFrame.BackgroundTransparency = 1
	textFrame.Parent = keybindFrame
	
	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 0, 20)
	label.Position = UDim2.new(0, 0, 0, 0)
	label.BackgroundTransparency = 1
	label.Text = config.label or "Keybind"
	label.TextColor3 = self.theme.foreground
	label.TextSize = 14
	label.Font = Enum.Font.GothamMedium
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Parent = textFrame
	
	if config.description then
		local desc = Instance.new("TextLabel")
		desc.Size = UDim2.new(1, 0, 0, 16)
		desc.Position = UDim2.new(0, 0, 0, 20)
		desc.BackgroundTransparency = 1
		desc.Text = config.description
		desc.TextColor3 = self.theme.muted
		desc.TextSize = 12
		desc.Font = Enum.Font.Gotham
		desc.TextXAlignment = Enum.TextXAlignment.Left
		desc.Parent = textFrame
	end
	
	-- Keybind button
	local keybindButton = Instance.new("Frame")
	keybindButton.Size = UDim2.new(0, 80, 0, 32)
	keybindButton.Position = UDim2.new(1, -80, 0, 4)
	keybindButton.BackgroundColor3 = self.theme.accentPanel
	keybindButton.BackgroundTransparency = 0.8
	
	local buttonCorner = Instance.new("UICorner")
	buttonCorner.CornerRadius = UDim.new(0, 8)
	buttonCorner.Parent = keybindButton
	
	local keyLabel = Instance.new("TextLabel")
	keyLabel.Size = UDim2.new(1, 0, 1, 0)
	keyLabel.Position = UDim2.new(0, 0, 0, 0)
	keyLabel.BackgroundTransparency = 1
	keyLabel.Text = config.value or "None"
	keyLabel.TextColor3 = self.theme.foreground
	keyLabel.TextSize = 14
	keyLabel.Font = Enum.Font.GothamMedium
	keyLabel.TextXAlignment = Enum.TextXAlignment.Center
	keyLabel.Parent = keybindButton
	
	local button = Instance.new("TextButton")
	button.Size = UDim2.new(1, 0, 1, 0)
	button.BackgroundTransparency = 1
	button.Text = ""
	button.Parent = keybindButton
	
	keybindButton.Parent = keybindFrame
	
	-- Keybind logic
	local isListening = false
	local currentKey = config.value or ""
	
	local function updateButton()
		if isListening then
			keyLabel.Text = "..."
			keybindButton.BackgroundColor3 = self.theme.accentBright
		else
			keyLabel.Text = currentKey ~= "" and currentKey or "None"
			keybindButton.BackgroundColor3 = self.theme.accentPanel
		end
	end
	
	local inputConnection
	
	button.MouseButton1Click:Connect(function()
		if isListening then
			-- Cancel listening
			isListening = false
			if inputConnection then
				inputConnection:Disconnect()
				inputConnection = nil
			end
			updateButton()
		else
			-- Start listening
			isListening = true
			updateButton()
			
			inputConnection = userinput.InputBegan:Connect(function(input, gameProcessed)
				if gameProcessed then return end
				
				if input.UserInputType == Enum.UserInputType.Keyboard then
					local keyName = input.KeyCode.Name
					-- Remove "Enum.KeyCode." prefix
					keyName = keyName:gsub("Enum.KeyCode.", "")
					
					currentKey = keyName
					isListening = false
					if inputConnection then
						inputConnection:Disconnect()
						inputConnection = nil
					end
					updateButton()
					
					if config.onChange then
						config.onChange(currentKey)
					end
				end
			end)
		end
	end)
	
	updateButton()
	
	return keybindFrame
end
